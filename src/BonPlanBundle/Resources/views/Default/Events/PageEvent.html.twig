{% extends '@BonPlan/Default/indexback.html.twig' %}

{% block body %}
    <body   style="background-repeat:no-repeat ; stroke:5px ; height:700px ; background-size: 100% 100%;background-image: url({{ asset('images/back.jpg') }}) ">

       <div class="content">
        <div class="container-fluid">
            <div class="row align-items-center">
                <h3  align="center" class="text-primary">Evenement</h3> <br>
                {% for e in event %}
                    <div  id="upd" class="col-sm-11">
                        <div class="col-sm-6">
                            <label>nom de l'évènement:</label>
                            <p   id="idnomEv" class="editable">  {{ e.nomev}} </p> <BR>
                            <label >Description de l'évènement:</label>
                            <p id="iddescEv" class="editable">{{ e.description}}</p><br>
                            <label >Nombre de place disponible: </label>
                            <p id="idnbplace" class="editable">  {{ e.nbrplace}}</p><br>
                        </div>
                        <div class="col-sm-6">
                            <label>Date début de l'évènement:</label>
                            <p  id="iddebut" class="text-ch"> {{ e.datedebutev|date("d/m/Y")}}</p><br>
                            <label>Date fin de l'évènement:</label>
                            <p id="idfin" class="text-ch">  {{ e.datefinev|date("d/m/Y")}}</p><br>
                            <label >Nombre de participants de l'évènement </label>
                            <p id="idnbparticipant" class="text-ch">  {{ e.nbparticipant}}</p>
                        </div>
                        {% if  is_granted("IS_AUTHENTICATED_REMEMBERED") and (is_granted("ROLE_PROP") )and( e.userPlan.id ==  app.user.id  ) %}
                            <!-- Trigger the modal with a button -->
                            <a  class="btn btn-success" href={{ path('Modifier_Event',{'id':e.idevents}) }} > Modifier</a>

                            {% if   e.etatev =='En cours' %}
                            {{ form_start(form) }}
                            {{ form_row(form.Annuler) }}
                            {{ form_end(form) }}
                            {% endif %}

                            &nbsp; <a  class="btn btn-danger"href={{ path('EventProp_consult') }} > Retour</a>
                        {% else%}
                            <a class="btn btn-danger" href={{ path('général_consult') }} > Retour</a>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="container">
              <!-- Modal -->
        <div class="modal fade" id="modierEvent" role="dialog">
            <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header" style="padding:35px 50px;">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 > Modifier votre évènement</h4>
                    </div>

                    <div class="modal-body" style="padding:40px 50px;">

                        {% for e in event %}

                       <form role="form" method="post" >

                                 <div class="form-group">
                                     <label for="nom"><span class="glyphicon-pencil"></span> Nom de l'évènement</label>
                                     <input type="text" class="form-control" id="nom"   placeholder="{{  e.nomev}}">
                                 </div>
                                 <div class="form-group">
                                     <label for="desc"><span class="glyphicon glyphicon-pencil"></span> Description:</label>
                                     <input type="text" class="form-control" id="desc" placeholder="{{ e.description}}">
                                 </div>
                                 <div class="form-group">
                                     <label for="deb"><span class="glyphicon glyphicon-calendar"></span> Début de l'évènement:</label>
                                     <input type="date" class="form-control" id="deb"  placeholder="{{ e.datedebutev|date("d/m/Y")}}">
                                 </div>
                                 <div class="form-group">
                                     <label for="fin"><span class="glyphicon glyphicon-calendar"></span>Fin de l'évènement:</label>
                                     <input type="date" class="form-control" id="fin" placeholder=" {{ e.datefinev|date("d/m/Y")}}" >
                                 </div>
                                 <div class="form-group">
                                     <label for="nb"><span class="glyphicon glyphicon-pencil"></span> nombre de places </label>
                                     <input type="number" class="form-control" id="nb" placeholder="{{ e.nbrplace}} " >
                                 </div>
                                <button type="submit" id="validbtn" class="btn btn-success btn-block" onclick="update({{ e.idevents }})">
                                    <span class="glyphicon glyphicon-ok-sign"></span> valider la modification</button>
                             </form>
                        {% endfor %}
                    </div>
                    <div class="modal-footer">

                        <button type="submit" class="btn btn-danger btn-default pull-left" data-dismiss="modal"> fermer</button>
                    </div>
                </div>
            </div>
        </div>
    </div>



    </body>

{% endblock %}


{% block javascript %}
    <script>
        $(document).ready(function(){
            $("#mdfEv").click(function(){
                $("#modierEvent").modal();
            });
        });


        function update($id) {

            var idev=$id;
            var nom= $("#nom").val();
            var description = $("#desc").val();
            var nbrP = $("#nb").val();
            var deb = $("#deb").val();
            var fin = $("#fin").val();


            Alert("AJAAAAAAAAAx");

            $.ajax({

                url: '@Url.Action("updateEvent","EventsController")',
                type: "POST",
                data: {
                    id:idev,
                    nom:nom,
                    desc:description,
                    debut:deb,
                    fin:fin,
                    nbrP:nbrP
                  },

                beforeSend: function () {
                    $("#nom").val('');


                },
                complete: function () {

                },
                success: function (data) {
                    var response = jQuery.parseJSON(data);
                    console.log(response);

                       $html =" <div class=\"col-sm-6\">\n" +
                           "\n" +

                           "   <label>nom de l'évènement:</label>\n" +
                           "   <p   id=\"idnomEv\" class=\"editable\">  "+response.nom+" </p> <BR>\n" +
                           "   <label >Description de l'évènement:</label>\n" +
                           "    <p id=\"iddescEv\" class=\"editable\">"+response.desc+"</p><br>\n" +
                           "    <label >Nombre de place disponible: </label><div >\n" +
                           "    <p id=\"idnbplace\" class=\"editable\">  "+response.nbrP+"</p><br>\n" +
                           "    </div>  \n" +response.user_name+
                           "    <div class=\"col-sm-6\">/span> <br>\n" +
                           "      <label>Date début de l'évènement:</label>\n" +
                           "       <p  id=\"iddebut\" class=\"text-ch\"> "+response.debut+"</p><br>\n" +
                           "                                " +response.comment+
                          "       <label>Date fin de l'évènement:</label>\n" +
                           "      <p id=\"idfin\" class=\"text-ch\">  "+response.fin+"</p><br>\n" +
                           "       <label >Nombre de participants de l'évènement </label>\n" +
                           "      <p id=\"idnbparticipant\" class=\"text-ch\">"+ response.nbrP+"</p>\n" +
                           "                        </div>\n" +
                           "                    </div>";

                       $("#upd").html($html);


                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(errorThrown)
                }
            });

        }
    </script>

{% endblock %}